<!DOCTYPE html>

<html>
<head>
  <title>dest.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>dest.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-229">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-229">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-230">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-230">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-231">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-231">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-232">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-232">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-233">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-233">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-234">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-234">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-235">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-235">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-236">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-236">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-237">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-237">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-238">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-238">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-239">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-239">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-240">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-240">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-241">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-241">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-242">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-242">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-243">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-243">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-244">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-244">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-245">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-245">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-246">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-246">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-247">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-247">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-248">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-248">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-249">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-249">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-250">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-250">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-251">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-251">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-252">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-252">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-253">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-253">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-254">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-254">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-255">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-255">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-256">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-256">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-257">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-257">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-258">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-258">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-259">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-259">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-260">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-260">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-261">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-261">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-262">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-262">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-263">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-263">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-264">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-264">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-265">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-265">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-266">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-266">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-267">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-267">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-268">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-268">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-269">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-269">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-270">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-270">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-271">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-271">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-272">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-272">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-273">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-273">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-274">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-274">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-275">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-275">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-276">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-276">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-277">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-277">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-278">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-278">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-279">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-279">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-280">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-280">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-281">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-281">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-282">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-282">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-283">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-283">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-284">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-284">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-285">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-285">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-286">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-286">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-287">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-287">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-288">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-288">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-289">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-289">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-290">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-290">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-291">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-291">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-292">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-292">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-293">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-293">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-294">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-294">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-295">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-295">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-296">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-296">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-297">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-297">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-298">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-298">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-299">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-299">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-300">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-300">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-301">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-301">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-302">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-302">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-303">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-303">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-304">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-304">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-305">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-305">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-306">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-306">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-307">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-307">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-308">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-308">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-309">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-309">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-310">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-310">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-311">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-311">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-312">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-312">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-313">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-313">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-314">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-314">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-315">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-315">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-316">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-316">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-317">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-317">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-318">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-318">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-319">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-319">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-320">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-320">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-321">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-321">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-322">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-322">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-323">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-323">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-324">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-324">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-325">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-325">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-326">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-326">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-327">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-327">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-328">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-328">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-329">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-329">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-330">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-330">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-331">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-331">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-332">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-332">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-333">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-333">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-334">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-334">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-335">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-335">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-336">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-336">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-337">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-337">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-338">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-338">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-339">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-339">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-340">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-340">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-341">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-341">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-342">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-342">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-343">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-343">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-344">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-344">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-345">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-345">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-346">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-346">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-347">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-347">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-348">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-348">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-349">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-349">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-350">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-350">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-351">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-351">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-352">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-352">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-353">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-353">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-354">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-354">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-355">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-355">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-356">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-356">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-357">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-357">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-358">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-358">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-359">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-359">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-360">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-360">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-361">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-361">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-362">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-362">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-363">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-363">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-364">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-364">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-365">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-365">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-366">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-366">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-367">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-367">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-368">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-368">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-369">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-369">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-370">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-370">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-371">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-371">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-372">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-372">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-373">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-373">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-374">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-374">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-375">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-375">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-376">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-376">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-377">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-377">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-378">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-378">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-379">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-379">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-380">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-380">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-381">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-381">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-382">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-382">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-383">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-383">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-384">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-384">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-385">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-385">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-386">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-386">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-387">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-387">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-388">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-388">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-389">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-389">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-390">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-390">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-391">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-391">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-392">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-392">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-393">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-393">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-394">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-394">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-395">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-395">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-396">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-396">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-397">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-397">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-398">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-398">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-399">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-399">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-400">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-400">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-401">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-401">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-402">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-402">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-403">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-403">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-404">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-404">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-405">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-405">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-406">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-406">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-407">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-407">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-408">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-408">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-409">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-409">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-410">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-410">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-411">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-411">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-412">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-412">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-413">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-413">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-414">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-414">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-415">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-415">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-416">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-416">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-417">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-417">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-418">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-418">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-419">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-419">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-420">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-420">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-421">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-421">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-422">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-422">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-423">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-423">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-424">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-424">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-425">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-425">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-426">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-426">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-427">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-427">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-428">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-428">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-429">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-429">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-430">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-430">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-431">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-431">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-432">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-432">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-433">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-433">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-434">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-434">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-435">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-435">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-436">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-436">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-437">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-437">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-438">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-438">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-439">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-439">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-440">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-440">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-441">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-441">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-442">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-442">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-443">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-443">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-444">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-444">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/orderSchema.js'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-445">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-445">&#182;</a>
              </div>
              <p>“/orders” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-446">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-446">&#182;</a>
              </div>
              <p>“/orders/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created but not delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/orders/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">false</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-447">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-447">&#182;</a>
              </div>
              <p>“/deliveries” route allows only a GET request,
which returns a json object which returns the array
 of orders for the sending individual order
 or deliveries made by the individual</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries'</span>)
  .get((req, res) =&gt; {
    Orders.find({
      owner_Id: req.session.passport.user,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-448">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-448">&#182;</a>
              </div>
              <p>“/deliveries/:id” @{:id} is used as an url
identifier to locate  a particular order
that has been created and delivered
to the user who created it.
a json response is sent with the order  for
 the GET request and a PUT request  responds
  with the newly updated order</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/deliveries/:id'</span>)
  .get((req, res) =&gt; {
    Orders.findOne({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  })
  .put((req, res) =&gt; {
    Orders.findOneAndUpdate({
      _id: req.params.id,
      delivered: <span class="hljs-literal">true</span>,
    }, {
      $set: req.body,
    }, (err, order) =&gt; {
      <span class="hljs-keyword">if</span> (order) {
        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json(order);
      }
      <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">204</span>).json(err);
    });
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> passport = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-449">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-449">&#182;</a>
              </div>
              <p>a sub-authetication router is created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> express.Router();</pre></div></div>
            
        </li>
        
        
        <li id="section-450">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-450">&#182;</a>
              </div>
              <p>importinng the converted UserModel from the schema</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../../models/userSchema.js'</span>).Users;</pre></div></div>
            
        </li>
        
        
        <li id="section-451">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-451">&#182;</a>
              </div>
              <p>import the passportInit and passing @ {passport} and @ {Users} model has a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">require</span>(<span class="hljs-string">'./passportInit.js'</span>)(passport, Users);</pre></div></div>
            
        </li>
        
        
        <li id="section-452">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-452">&#182;</a>
              </div>
              <p>@ ‘signIn’ Route a post requests is sent
the request body contains the email and password has a body
which is used for login  authetication
and a json response which contains the userId  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignIn'</span>)
  .post(passport.authenticate(<span class="hljs-string">'login'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-453">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-453">&#182;</a>
              </div>
              <p>@ ‘signUp’ Route a post requests is sent
the request body contains the email , password  and profile object has a body
which is used for login  authetication
and a json response which cotains the userid  is sent with the user data;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/SignUp'</span>)
  .post(passport.authenticate(<span class="hljs-string">'signUp'</span>, {}), (req, res) =&gt; {
    res.status(<span class="hljs-number">200</span>).json({
      userId: req.session.passport,
    });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-454">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-454">&#182;</a>
              </div>
              <p>if the user is succesfull in login in a
user object is sent back to the user has response during a get request
has a post request the corresponding sent data is updated by the user
the dashboard route sends back and update the registered user’s
correspoinding biodatas if the user is unauthorized , the response
is sent has a 401 response which is unaythorized request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/dashBoard'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      Users.findOne({
        _id: req.session.passport.user,
      }, (userErr, user) =&gt; {
        <span class="hljs-keyword">if</span> (userErr) {
          <span class="hljs-keyword">return</span> (userErr);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-455">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-455">&#182;</a>
              </div>
              <p>sends a response with the user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> res.status(<span class="hljs-number">200</span>).json({
          user,
        });
      });
    } <span class="hljs-keyword">else</span> {
      res.status(<span class="hljs-number">401</span>).json({
        mgs: <span class="hljs-string">'unauthorize request login'</span>,
      });
    }
  })
  .post((req, res) =&gt; {
    <span class="hljs-keyword">const</span> newBio = req.body;

    Users.findOneAndUpdate({
      owner_ID: req.session.passport.user,
    }, {
      $set: newBio,
    }, {
      <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>,
      upsert: <span class="hljs-literal">true</span>,
    }, (err, User) =&gt; {
      <span class="hljs-keyword">if</span> (err) {
        res.status(<span class="hljs-number">401</span>).json(err);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-456">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-456">&#182;</a>
              </div>
              <p>the newly user object is sent back has a response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      res.status(<span class="hljs-number">201</span>).json(User);
    });
  })
  .put((req, res) =&gt; {
    res.json({ message: <span class="hljs-string">'not update from server'</span> });
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-457">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-457">&#182;</a>
              </div>
              <p>this routes enable a login user to log out of the system</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router
  .route(<span class="hljs-string">'/logOut'</span>)
  .get((req, res) =&gt; {
    <span class="hljs-keyword">if</span> (req.isAuthenticated()) {
      req.logOut();
    }
    res.redirect(<span class="hljs-string">'/'</span>);
  });

<span class="hljs-built_in">module</span>.exports = router;

<span class="hljs-keyword">const</span> LocalStrategy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'passport-local'</span>).Strategy;</pre></div></div>
            
        </li>
        
        
        <li id="section-458">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-458">&#182;</a>
              </div>
              <p>const bcrypt = require(‘bcrypt-nodejs’); for authetication in production</p>

            </div>
            
        </li>
        
        
        <li id="section-459">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-459">&#182;</a>
              </div>
              <p>module used for random number generation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-460">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-460">&#182;</a>
              </div>
              <p>const biguint = require(‘biguint-format’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> isValidPassword = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidPassword</span>(<span class="hljs-params">user, password</span>) </span>{
  <span class="hljs-keyword">return</span> user.password !== password;
  <span class="hljs-comment">/* bcrypt.compareSync(password, user.password);*/</span>
};

<span class="hljs-keyword">const</span> createHash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createHash</span>(<span class="hljs-params">password</span>) </span>{
  <span class="hljs-keyword">return</span> password;
  <span class="hljs-comment">/* bcrypt.hashSync(password, bcrypt.genSaltSync(10), null);*/</span>
};</pre></div></div>
            
        </li>
        
        
        <li id="section-461">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-461">&#182;</a>
              </div>
              <p>which is the number of constiables to be generated.
this random method takes a parameter @{qty},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">random</span>(<span class="hljs-params">qty</span>) </span>{
  <span class="hljs-keyword">return</span> crypto.randomBytes(qty);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-462">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-462">&#182;</a>
              </div>
              <p>the function is exported and @{passport, usersmodel} is passed
has a parameter when imported
into the autitication route;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authExport</span>(<span class="hljs-params">passport, Users</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-463">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-463">&#182;</a>
              </div>
              <p>serializeuser by holding ID for identifing specific user
sends  back a key  to decrypt the user
function serializingCallback(user, done) {
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.serializeUser((user, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-464">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-464">&#182;</a>
              </div>
              <p>console.log(‘serializing’ + user._id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, user._id);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-465">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-465">&#182;</a>
              </div>
              <p>deserializeuser by using the serialize Key
 for decrytpting the user data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.deserializeUser((_id, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-466">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-466">&#182;</a>
              </div>
              <p>console.log(‘deserializing’ + _id);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    done(<span class="hljs-literal">null</span>, Users.findById(_id, (err, user) =&gt; {
      <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-467">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-467">&#182;</a>
              </div>
              <p>console.log(‘there is an error’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> err;
      }
      <span class="hljs-keyword">return</span> user;
    }));
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-468">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-468">&#182;</a>
              </div>
              <p>a ‘SignIn’ strategy has been created to autheticated Users
the function makes use of  two parameters @{email} @{password}
and sends a err response if it failed or user if succesfull.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  passport.use(<span class="hljs-string">'login'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-469">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-469">&#182;</a>
              </div>
              <p>TODO: user NOT FOUND TODO: INVALID password TODO: AUTHENTICATE user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email,
      }, (err, user) =&gt; {
        <span class="hljs-keyword">if</span> (err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-470">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-470">&#182;</a>
              </div>
              <p>console.log(err);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'user not found'</span> });
        }
        <span class="hljs-keyword">if</span> (user === <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'emailAddress not found'</span> });
        }
        <span class="hljs-keyword">if</span> (isValidPassword(user, password)) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'INVALID password'</span> });
        }
        <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, user);
      });
    }));</pre></div></div>
            
        </li>
        
        
        <li id="section-471">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-471">&#182;</a>
              </div>
              <p>a ‘signUp’ strategy has been created to autheticated Users
the function makes use of  mutiple parameters @{emaiil} @{password} @{userProfile Object}
and sends a err response if it failed or user if succesfull.
passReqToCallback: allows us to pass back the entire request to the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  passport.use(<span class="hljs-string">'signUp'</span>, <span class="hljs-keyword">new</span> LocalStrategy({
    passReqToCallback: <span class="hljs-literal">true</span>,
    usernameField: <span class="hljs-string">'email'</span>,
    passwordField: <span class="hljs-string">'password'</span> },
    (req, email, password, done) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-472">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-472">&#182;</a>
              </div>
              <p>find a user in mongo with provided emailAddress</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Users.findOne({
        email }, (err, user) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-473">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-473">&#182;</a>
              </div>
              <p>In case of any error, return using the done method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> done(err);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-474">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-474">&#182;</a>
              </div>
              <p>already exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (user) {
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
            message: <span class="hljs-string">'userEmail already exist'</span> });
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-475">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-475">&#182;</a>
              </div>
              <p>if there is no user, create the user
to  understand the user validation process
<a href='./userSchema.html'>userSchema</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> newuser = <span class="hljs-keyword">new</span> Users({
          password: createHash(password),
          email,
          profile: {
            fullName: req.body.fullName,
            userName: req.body.userName,
            phoneNo: req.body.phoneNo,
            customerId: random(<span class="hljs-number">7</span>) } });</pre></div></div>
            
        </li>
        
        
        <li id="section-476">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-476">&#182;</a>
              </div>
              <p>save the user
console.log(newuser);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        newuser.save((saveErr) =&gt; {
          <span class="hljs-keyword">if</span> (saveErr) {</pre></div></div>
            
        </li>
        
        
        <li id="section-477">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-477">&#182;</a>
              </div>
              <p>console.log(‘Error in Saving user: ‘ + err);
throw err;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span>, {
              message: <span class="hljs-string">'userSignUpvalidation fail'</span>,
              err: saveErr });
          }
          <span class="hljs-keyword">return</span> done(<span class="hljs-literal">null</span>, newuser);
          <span class="hljs-comment">/* console.log(newuser.username + ' Registration succesful');*/</span>
        });
      });
    }));
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-478">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-478">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-479">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-479">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-480">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-480">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-481">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-481">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-482">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-482">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-483">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-483">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-484">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-484">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-485">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-485">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-486">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-486">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-487">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-487">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-488">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-488">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-489">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-489">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-490">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-490">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-491">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-491">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-492">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-492">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-493">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-493">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-494">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-494">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-495">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-495">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-496">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-496">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-497">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-497">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-498">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-498">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-499">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-499">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-500">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-500">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-501">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-501">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-502">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-502">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-503">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-503">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-504">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-504">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-505">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-505">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-506">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-506">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-507">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-507">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-508">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-508">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-509">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-509">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-510">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-510">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-511">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-511">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-512">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-512">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-513">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-513">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-514">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-514">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-515">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-515">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-516">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-516">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-517">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-517">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-518">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-518">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-519">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-519">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-520">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-520">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-521">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-521">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-522">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-522">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-523">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-523">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-524">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-524">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-525">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-525">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-526">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-526">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-527">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-527">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-528">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-528">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-529">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-529">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-530">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-530">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-531">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-531">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-532">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-532">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-533">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-533">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-534">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-534">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-535">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-535">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-536">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-536">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-537">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-537">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-538">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-538">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-539">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-539">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-540">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-540">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-541">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-541">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-542">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-542">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-543">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-543">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-544">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-544">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-545">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-545">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-546">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-546">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-547">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-547">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-548">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-548">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-549">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-549">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-550">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-550">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-551">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-551">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-552">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-552">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-553">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-553">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-554">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-554">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-555">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-555">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-556">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-556">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-557">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-557">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-558">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-558">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-559">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-559">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-560">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-560">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-561">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-561">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-562">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-562">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-563">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-563">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-564">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-564">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-565">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-565">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-566">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-566">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-567">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-567">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-568">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-568">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-569">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-569">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-570">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-570">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-571">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-571">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-572">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-572">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-573">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-573">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-574">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-574">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-575">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-575">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-576">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-576">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-577">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-577">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-578">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-578">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-579">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-579">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-580">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-580">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-581">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-581">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-582">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-582">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-583">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-583">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-584">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-584">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-585">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-585">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-586">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-586">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-587">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-587">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-588">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-588">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-589">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-589">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-590">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-590">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-591">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-591">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-592">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-592">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-593">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-593">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-594">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-594">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-595">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-595">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-596">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-596">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-597">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-597">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-598">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-598">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-599">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-599">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-600">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-600">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-601">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-601">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-602">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-602">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-603">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-603">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-604">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-604">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-605">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-605">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-606">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-606">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-607">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-607">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-608">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-608">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-609">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-609">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-610">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-610">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-611">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-611">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-612">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-612">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-613">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-613">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-614">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-614">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-615">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-615">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-616">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-616">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-617">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-617">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-618">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-618">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-619">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-619">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-620">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-620">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-621">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-621">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-622">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-622">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-623">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-623">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-624">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-624">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-625">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-625">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-626">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-626">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-627">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-627">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-628">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-628">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-629">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-629">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-630">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-630">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-631">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-631">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-632">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-632">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-633">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-633">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;
<span class="hljs-keyword">const</span> ObjectId = mongoose.Schema.Types.ObjectId;

<span class="hljs-keyword">const</span> orderSchema = schema({
  owner_Id: ObjectId,
  agent_Id: ObjectId,
  hint: <span class="hljs-built_in">String</span>,
  details: <span class="hljs-built_in">String</span>,
  deliveryTime: <span class="hljs-built_in">String</span>,
  dateCreated: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
  },
});

<span class="hljs-keyword">const</span> Orders = mongoose.model(<span class="hljs-string">'Orders'</span>, orderSchema);

<span class="hljs-built_in">module</span>.exports = {
  Orders,
};

<span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">const</span> schema = mongoose.Schema;</pre></div></div>
            
        </li>
        
        
        <li id="section-634">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-634">&#182;</a>
              </div>
              <p>creating a schema which show the validation of userbiodata
which takes email, password, fullName,imgurl has strings
phoneNo has a Number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Userschema = <span class="hljs-keyword">new</span> schema({
  email: {
    type: <span class="hljs-built_in">String</span>,
    unique: <span class="hljs-literal">true</span>,
    required: <span class="hljs-literal">true</span>,
  },
  password: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
  },
  profile: {
    fullName: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>,
    },
    phoneNo: {
      type: <span class="hljs-built_in">Number</span>,
      required: <span class="hljs-literal">true</span>,
    },
    customerId: {
      type: <span class="hljs-built_in">String</span>,
      unique: <span class="hljs-literal">true</span>,
      required: <span class="hljs-literal">true</span>,
    },
    imgUrl: <span class="hljs-built_in">String</span>,
  },
});</pre></div></div>
            
        </li>
        
        
        <li id="section-635">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-635">&#182;</a>
              </div>
              <p>converts the usershema to a user model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Users = mongoose.model(<span class="hljs-string">'Users'</span>, Userschema);</pre></div></div>
            
        </li>
        
        
        <li id="section-636">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-636">&#182;</a>
              </div>
              <p>exporting the model has Users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = {
  Users,
};

<span class="hljs-keyword">const</span> Orders = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./../models/orderShema.js'</span>).Orders;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCurrentFeedList</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'connetcd mr abey'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-637">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-637">&#182;</a>
              </div>
              <p>{
  sort: {
    dateCreated: -1,
  },
  limit: 15,
}</p>

            </div>
            
        </li>
        
        
        <li id="section-638">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-638">&#182;</a>
              </div>
              <p>function getCurrentFeedList() {
  return Orders.find({}, {}, (err, order) =&gt; {
    if (err) {
      return err;
    }
    console.log(order);
    return order;
  });
}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">console</span>.log(getCurrentFeedList());

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">realtimeFeed</span>(<span class="hljs-params">io</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'branching io'</span>);
  io.on(<span class="hljs-string">'connection'</span>, (socket) =&gt; {</pre></div></div>
            
        </li>
        
        
        <li id="section-639">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-639">&#182;</a>
              </div>
              <p>on connection the server sends a
limited feedList of already created
 orders to the feed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> ordersList = [{
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 40: 43 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'knsjfnsjfnjff'</span>,
      hint: <span class="hljs-string">'jnsdjsfnskfm'</span>,
      _id: <span class="hljs-string">'573 cef6be9206b3027d2b733'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 41: 37 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      details: <span class="hljs-string">'sksdknds'</span>,
      hint: <span class="hljs-string">'sdnjvsn v'</span>,
      _id: <span class="hljs-string">'573 cefa1e9206b3027d2b734'</span>,
    }, {
      dateCreated: <span class="hljs-string">' Wed May 18 2016 23: 45: 05 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'1hr'</span>,
      hint: <span class="hljs-string">'sdosdpisdbco'</span>,
      details: <span class="hljs-string">'sdvsdvvs'</span>,
      _id: <span class="hljs-string">'573 cf071e9206b3027d2b735'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 26 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573cf0c2ec0c395005cc9110'</span>,
    }, {
      dateCreated: <span class="hljs-string">'Wed May 18 2016 23: 46: 48 GMT + 0100(W.Central Africa Standard Time'</span>,
      __v: <span class="hljs-number">0</span>,
      deliveryTime: <span class="hljs-string">'5 mins'</span>,
      details: <span class="hljs-string">'lsdmlvms;vms;vns .'</span>,
      hint: <span class="hljs-string">'lijihidc'</span>,
      _id: <span class="hljs-string">'573 cf0d8ec0c395005cc9111'</span>,
    }];
    socket.emit(<span class="hljs-string">'clientReceiveOrders'</span>, ordersList);</pre></div></div>
            
        </li>
        
        
        <li id="section-640">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-640">&#182;</a>
              </div>
              <p>if the sever recieves an Order, the server
 first validate the new Order if it’s
 valid then saves it else should send
 a report to the order owner the pending
  error during validation.
  a callback is made in which returns
  the data or error for the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    socket.on(<span class="hljs-string">'serverReceiveOrder'</span>, (data, callback) =&gt; {
      <span class="hljs-keyword">const</span> saveData = <span class="hljs-keyword">new</span> Orders(data);
      saveData.save((err) =&gt; {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-built_in">console</span>.log(err);
          callback({
            err,
          }, <span class="hljs-literal">undefined</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-641">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-641">&#182;</a>
              </div>
              <p>TODO: notify the Creator of the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        } <span class="hljs-keyword">else</span> {
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'no error'</span>);
          callback(<span class="hljs-literal">undefined</span>, {
            saveData,
          });</pre></div></div>
            
        </li>
        
        
        <li id="section-642">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-642">&#182;</a>
              </div>
              <p>sends back the order to the generic
 feed after succesfull validation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          io.sockets.emit(<span class="hljs-string">'clientReceiveNewOrder'</span>, saveData);
        }
      });
    });
  });
};

<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> router = express.Router();

<span class="hljs-comment">/* GET home page. */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-643">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-643">&#182;</a>
              </div>
              <p>sends the home page to the client browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
  res.render(<span class="hljs-string">'index'</span>, { title: <span class="hljs-string">'Express'</span> });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-644">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-644">&#182;</a>
              </div>
              <p>creating a sub router string to all base routes imported from
<a href="./auth.html">auth.js</a>
geting a url with “/auth/<subRoute>“ string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>router.use(<span class="hljs-string">'/auth'</span>, <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth/auth.js'</span>));

<span class="hljs-built_in">module</span>.exports = router;</pre></div></div>
            
        </li>
        
        
        <li id="section-645">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-645">&#182;</a>
              </div>
              <p><a href="./users.html">link a</a></p>

            </div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
